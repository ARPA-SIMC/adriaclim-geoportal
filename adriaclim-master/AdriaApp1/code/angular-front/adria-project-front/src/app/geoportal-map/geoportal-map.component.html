<style>
  .font-weight-bold {
    font-weight: bold;
  }
</style>
<div class="main-content">

  <div fxFlex class="toolbar">
    <mat-toolbar color="primary">

      <div fxFlex fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="20px" style="height: 85%;"
        class="toolbar-buttons">

        <button fxFlex="20" mat-raised-button style="color: #fff; background-color: rgba(0, 221, 221, 0.795);"
          #menuTrigger="matMenuTrigger" [matMenuTriggerFor]="myMenu2"> <mat-icon> list_alt</mat-icon> <span
            class="text-menu"> Full list </span>
        </button>

        <button fxFlex="20" mat-raised-button style="color: #fff; background-color: rgba(0, 221, 221, 0.795);"
          #menuTrigger="matMenuTrigger" [matMenuTriggerFor]="myMenu1"> <mat-icon>public</mat-icon> <span
            class="text-menu"> Dataset </span>
        </button>

        <form [formGroup]="selData">
          <mat-radio-group formControlName="dataSetSel">

            <mat-menu #myMenu2="matMenu" class="menu-full-list">
              <ng-template matMenuContent>
                <!-- <mat-radio-button class="example-radio-button" *ngFor="let season of seasons" [value]="season"> -->
                <div fxFlex fxLayout="column" fxLayoutAlign="center start">
                  <div fxFlex style="width: 100%;" fxLayout="row" fxLayoutAlign="center center"
                    (click)="$event.stopPropagation();">
                    <mat-form-field class="example-full-width" color="primary" appearance="outline">
                      <mat-label fxFlex="80">Filter title or institution</mat-label>
                      <!-- <mat-icon fxFlex="20" fxLayoutAlign="end center">search</mat-icon> -->
                      <input type="text" matInput formControlName="searchText">
                      <button matSuffix mat-icon-button aria-label="Clear">
                        <mat-icon>search</mat-icon>
                      </button>
                    </mat-form-field>
                    <!-- {{selData.get("searchText")?.value | json}} -->
                  </div>
                  <ng-container *ngFor="let n of dataAllNodes | appFilter: selData.get('searchText')?.value">
                    <!-- <ng-container *ngFor="let n of dataAllNodes | highlight: selData.get('searchText')?.value"> -->
                    <div fxFlex fxLayout="row" fxLayoutAlign="center center">
                      <!-- <mat-radio-button fxFlex class="example-radio-button"  appHighlight [searchedWord]="selData.get('searchText')?.value" [content]="n" [classToApply]="'font-weight: bold'" [setTitle]="true" [value]="n" (change)="getMeta(n.name.id); getSelectedNode(n)">
                        {{n.name.title}}
                      </mat-radio-button> -->
                      <mat-radio-button fxFlex class="example-radio-button" [value]="n"
                        (change)="getMeta(n.name.id); addToActiveLayers(n); getSelectedNode(n); ">
                        {{n.name.title}}
                      </mat-radio-button>
                    </div>
                    <mat-divider style="width: 100%; margin: 10px 0px;"></mat-divider>

                  </ng-container>

                </div>
              </ng-template>

            </mat-menu>

            <mat-menu #myMenu1="matMenu" class="menu">
              <div fxFlex fxLayout="column" fxLayoutAlign="center start">
                <div fxFlex style="width: 100%;" fxLayout="row" fxLayoutAlign="center center"
                  (click)="$event.stopPropagation();">
                  <mat-form-field class="example-full-width" color="primary" appearance="outline">
                    <mat-label fxFlex="100">Filter title or institution</mat-label>
                    <!-- <mat-icon fxFlex="20" fxLayoutAlign="end center">search</mat-icon> -->
                    <input type="text" matInput formControlName="searchTextDataset">
                    <button matSuffix mat-icon-button aria-label="Clear">
                      <mat-icon>search</mat-icon>
                    </button>
                  </mat-form-field>
                  <!-- {{selData.get("searchText")?.value | json}} -->
                </div>
              </div>
              <ng-template matMenuContent>

                <mat-tree [dataSource]="dataAllNodesTree" [treeControl]="treeControl">
                  <mat-tree-node *matTreeNodeDef="let node; let lastItem = last" matTreeNodePadding>
                    <!-- {{node | json}} -->
                    <!-- <ng-container *ngIf="node.expandable === false && node.level > 2; else noRadio"> -->
                    <ng-container *ngIf="node.expandable === false && !isAString(node.name); else noRadio">
                      <div fxFlex fxLayout="column" fxLayoutAlign="center start"
                        style="max-width: none !important; width: fit-content;">
                        <div fxFlex fxLayout="row" fxLayoutAlign="center center"
                          style="max-width: none !important; width: fit-content;">
                          <button matTooltip="Info about the layer" matTooltipPosition="left"><mat-icon fxFlex="90"
                              [ngStyle]="{'color': 'blue'}"
                              (click)="openTableDialog(node.name['id'], node.name['title'], node)">info</mat-icon></button>
                          <mat-radio-button fxFlex [value]="node"
                            (change)="getMeta(node.name['id']); getSelectedNode(node); addToActiveLayers(node)">{{node.name["title"]}}</mat-radio-button>

                        </div>
                        <mat-divider style="width: 100%; margin: 10px 0px;" *ngIf="!lastItem"></mat-divider>

                      </div>
                    </ng-container>

                    <ng-template #noRadio>
                      <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
                        <mat-icon class="mat-icon-rtl-mirror">
                          {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                        </mat-icon>
                      </button>
                      {{node.name}}
                    </ng-template>

                  </mat-tree-node>

                  <!-- <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
                    <button mat-icon-button matTreeNodeToggle [attr.aria-label]="'Toggle ' + node.name">
                      <mat-icon class="mat-icon-rtl-mirror">
                        {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                      </mat-icon>
                    </button>
                    {{node.name}}

                  </mat-tree-node> -->

                </mat-tree>

                <!-- <button mat-menu-item>A 1</button>
                <button mat-menu-item>A 2</button>
                <button mat-menu-item>A 3</button> -->
              </ng-template>
            </mat-menu>
          </mat-radio-group>
        </form>

        <!-- <button fxFlex="20" mat-raised-button color="warn"
          #menuTrigger="matMenuTrigger"
          [matMenuTriggerFor]="myMenu2"> <span class="text-menu"> Variable </span></button> -->
        <!-- (mouseenter)="openMyMenu(menuTrigger)" -->

          <div fxFlex="20" fxLayout="row" class="menu-var" LayoutAlign="center center">
            <form [formGroup]="variableGroup">
              <ng-container *ngIf="variableArray.length > 0; else noVariable">
                <!-- <ng-container *ngFor="let v of variableArray; let lastItem = last">

                  <button mat-menu-item>{{v}}</button>
                  <mat-divider *ngIf="!lastItem"></mat-divider>
                </ng-container> -->

                <mat-form-field appearance="fill" class="prova-form">
                  <mat-label>Select variable</mat-label>
                  <mat-select formControlName="variableControl" class="prova-select"
                    (selectionChange)="getMeta(selData.get('dataSetSel')?.value.name.id, 'ok')">
                    <mat-option *ngFor="let v of variableArray" [value]="v" class="prova-option">
                      {{v}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </ng-container>


              <ng-template #noVariable>
                <!-- <span>First select dataset</span> -->
                <mat-form-field appearance="fill">
                  <mat-label>First select dataset</mat-label>
                  <mat-select>
                    <mat-option>
                      First select dataset
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </ng-template>

            </form>

          </div>

        <!-- <mat-menu #myMenu2="matMenu">
          <ng-template matMenuContent>
              <ng-container *ngFor="let v of variableArray">
            </ng-container>
              <button mat-menu-item>A 2</button>
                <button mat-menu-item>A 3</button>

          </ng-template>

        </mat-menu> -->
        <!-- <mat-icon>settings</mat-icon> -->
        <!-- <button mat-icon-button><mat-icon> place</mat-icon></button> -->

        <!-- <mat-expansion-panel class="expansion-panel-class" #panel (mouseenter)="panel.open()" (mouseleave)="panel.close()">
            <mat-expansion-panel-header>
            HEAD
            </mat-expansion-panel-header>
            <button mat-menu-item>A 1</button>
            <button mat-menu-item>A 2</button>
            <button mat-menu-item>A 3</button>
          </mat-expansion-panel> -->
      </div>
      <!-- <div fxFlex *ngIf="selectedDate.get('dateSel')?.value">
        {{selectedDate.get("dateSel")?.value}}
      </div> -->
    </mat-toolbar>
  </div>

  <!-- MAT MENU PER TOOLS -->
  <!-- <div fxFlex="fit-content" fxLayout="row" fxLayoutAlign="center center" class="overlay-tools"> -->
  <div class="overlay-tools">
    <button fxFlex="20" mat-raised-button style="color: #fff; background-color: rgba(0, 221, 221, 0.795);"
        #menuTrigger="matMenuTrigger" [matMenuTriggerFor]="myMenuTools">
      <mat-icon> list_alt</mat-icon>
      <span class="text-menu"> Tools </span>
    </button>

    <mat-menu #myMenuTools="matMenu" class="menu-tools">
      <ng-template matMenuContent>
        <div fxFlex fxLayout="column" fxLayoutAlign="center start">
          <div>
            <button mat-icon-button matTooltip="Select a single point on the map" matTooltipPosition="right" (click)="pointSelect()"><mat-icon> place</mat-icon></button>
          </div>
          <div>
            <button mat-icon-button matTooltip="Select all points in one of the areas shown" (click)="polygonSelect()" matTooltipPosition="right"><mat-icon>touch_app</mat-icon></button>
          </div>

        </div>
      </ng-template>

    </mat-menu>
  </div>
  <!-- MAT MENU PER SCELTA POLIGONI -->
  <!-- <div fxFlex="fit-content" fxLayout="row" fxLayoutAlign="center center" class="overlay-polygon"> -->
  <div class="overlay-polygon">
    <button fxFlex="20" mat-raised-button style="color: #fff; background-color: rgba(0, 221, 221, 0.795);"
        #menuTrigger="matMenuTrigger" [matMenuTriggerFor]="myMenuPolygon">
      <mat-icon> list_alt</mat-icon>
      <span class="text-menu"> Areas </span>
    </button>

    <!--Modifichiamo dopo!-->
    <mat-menu #myMenuPolygon="matMenu" class="polygon-tools">
      <ng-template matMenuContent>
        <div fxFlex fxLayout="column" fxLayoutAlign="center start">
          <div>
            <button mat-button matTooltip="Select the Adriatic view" matTooltipPosition="right" (click)="adriaticView()" class="font-bad-script">Adriatic View</button>
          </div>
          <div>
            <button mat-button matTooltip="Select the Pilot view" matTooltipPosition="right" (click)="pilotView()" class="font-bad-script">Pilot View</button>
          </div>
          <div>
            <button mat-button matTooltip="Upload a GeoJSON with your polygons" matTooltipPosition="right" (click)="uploadGeo()" class="font-bad-script">Upload a GeoJSON</button>
          </div>
          <div>
            <button mat-button matTooltip="Upload a GeoJSON with your polygons" matTooltipPosition="right" (click)="removeAllPolygons()" class="font-bad-script">Remove all</button>
          </div>

        </div>
      </ng-template>

    </mat-menu>
  </div>

  <ng-container *ngIf="selData.get('dataSetSel')?.value">
    <!-- <div fxFlex="fit-content" fxLayout="row" fxLayoutAlign="center center" class="overlay-buttons-top-map"> -->
    <div class="overlay-buttons-top-map">
      <mat-card class="dataset-panel" fxFlex fxLayout="column" fxLayoutAlign="start center" class="mat-card-active">
        <mat-card-header>
          <mat-card-title class="bolder-title">Active layer</mat-card-title>
        </mat-card-header>
        <mat-card-content style="height: 100%;" fxFlex="100" fxLayout="row wrap" fxLayoutAlign="center center" class="mat-card-active">
          <!-- <div fxFlex="80" style="height: 100%; overflow: auto;"> -->
          <div fxFlex="90" fxLayout="row" fxLayoutAlign="space-evenly center" class="edit-icon-size" fxLayoutGap="10px">

            <div fxFlex fxLayout="row" class="menu-var" fxLayoutAlign="center center">
              <form [formGroup]="selData" fxFlex>

                <mat-form-field appearance="fill" fxFlex>
                  <mat-label>Select Layers</mat-label>
                  <!-- <mat-select formControlName="activeLayersControl" (selectionChange)="getMeta(activeLayersGroup.get('activeLayersControl')?.value.name.dataset_id, 'ok')"> -->
                  <mat-select formControlName="dataSetSel" (selectionChange)="selActiveLayer($event)">
                    <mat-option *ngFor="let a of activeLayersArray" [value]="a">
                      {{a.name.title}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

              </form>

            </div>
            <div fxFlex="25" fxLayout="row" fxLayoutAlign="space-evenly center">
              <button fxFlex="40" matTooltip="Info about the layer"><mat-icon [ngStyle]="{'color': 'blue'}"
                  (click)="openTableDialog()">info</mat-icon>
              </button>
              <button fxFlex="40" matTooltip="Remove the layer"><mat-icon [ngStyle]="{'color': 'red'}"
                  (click)="deleteLayer(); deleteElActiveLayers()">delete</mat-icon>
              </button>

            </div>
            <!-- {{selData.get("dataSetSel")?.value | json}} -->
            <!-- <span>{{selData.get("dataSetSel")?.value.name.title}}</span> -->


            <!-- <mat-selection-list fxFlex="100" [multiple]="false" fxLayoutAlign="center center" fxLayout="row wrap" style="word-wrap: break-word; overflow-wrap: break-word">
                  <mat-list-option fxFlex="100" fxLayoutAlign="start center" [value]="elem" *ngFor="let elem of dataInd">{{elem.title}}</mat-list-option>
                </mat-selection-list> -->
          </div>

          <div fxFlex="90" style="margin: 10px 0px 5px 0px;" fxLayout="row" fxLayoutAlign="center center">
            <form [formGroup]="selectedDate" fxFlex="50">
              <div fxFlex="100" fxLayout="row" fxLayoutAlign="center center" class="form-datepicker">
                <mat-form-field appearance="fill" fxFlex fxLayout="row" fxLayoutAlign="center center">
                  <mat-label>DD/MM/YYYY</mat-label>
                  <input matInput [matDatepicker]="datepicker" [matDatepickerFilter]="dateFilter" [min]="dateStart"
                    [max]="dateEnd" formControlName="dateSel" fxFlex>
                  <!-- <mat-hint>DD/MM/YYYY</mat-hint> -->
                  <mat-datepicker-toggle fxFlex matIconSuffix [for]="datepicker"></mat-datepicker-toggle>
                  <mat-datepicker #datepicker>
                    <mat-datepicker-actions>
                      <button mat-button matDatepickerCancel>Cancel</button>
                      <button mat-raised-button color="primary" matDatepickerApply
                        (click)="getMeta(selData.get('dataSetSel')?.value.name.id, 'ok')">Apply</button>
                    </mat-datepicker-actions>
                  </mat-datepicker>
                </mat-form-field>

              </div>
            </form>
            <div fxFlex="50" fxLayout="row" fxLayoutAlign="center center">
              <!-- DA FARE!! -->
              <button mat-icon-button fxFlex (click)="changeDate('leftAll')"><mat-icon>first_page</mat-icon></button>
              <!-- dateStart: {{dateStart}} dateEnd: {{dateEnd}} -->
              <button mat-icon-button fxFlex (click)="changeDate('left')"
                [disabled]="navigateDateLeftYear || navigateDateLeftMonth || navigateDateLeftSeason || dateStart?.toString() === dateEnd?.toString()"><mat-icon>navigate_before</mat-icon></button>
              <button mat-icon-button fxFlex (click)="changeDate('right')"
                [disabled]="navigateDateRightYear || navigateDateRightMonth || navigateDateRightSeason || dateStart === dateEnd"><mat-icon>navigate_next</mat-icon></button>
              <button mat-icon-button fxFlex (click)="changeDate('rightAll')"><mat-icon>last_page</mat-icon></button>

            </div>
          </div>

          <div fxFlex="90" style="margin: 10px 0px 5px 0px; height: fit-content;" fxLayout="column" fxLayoutAlign="center center" *ngIf="isExtraParam">
            <form [formGroup]="sliderGroup" fxFlex fxLayout="column" style="width: 100%;" fxLayoutAlign="center center">
              <div class="example-label-container" style="width: 80%;" fxLayout="row" fxLayoutAlign="space-between center">
                <label fxFlex fxLayoutAlign="center center" id="example-name-label" class="example-name-label">{{extraParam.name}}</label>
                <!-- <label class="example-value-label">{{value}}</label> -->
                <!-- <label fxFlex fxLayoutAlign="center center" class="example-value-label">5</label> -->
              </div>
              <!-- [disabled]="disabled" -->
              <ngx-slider [(value)]="value" [options]="options" (userChangeEnd)="sliderControl($event)"></ngx-slider>
              <!-- <mat-slider
                  style="width: 80%;"
                  class="example-margin"
                  [max]="extraParam.maxValue.toFixed(4)"
                  [min]="extraParam.minValue.toFixed(4)"
                  [step]="extraParam.stepSize.toFixed(4)"
                  discrete
                  showTickMarks
                  [displayWith]="formatLabel">
                <input matSliderThumb formControlName="sliderControl" (mouseup)="sliderControl($event)">
              </mat-slider> -->

            </form>
            <!-- <mat-slider style="width: 80%;"
                class="example-margin"
                [displayWith]="formatLabel"
                >
              <input matSliderThumb>
            </mat-slider> -->
          </div>
          <!-- </div> -->
        </mat-card-content>
      </mat-card>
    </div>
  </ng-container>

  <div fxFlex="fit-content" fxLayout="row" fxLayoutAlign="center center" class="overlay-image">
    <ng-container *ngIf="this.selData.get('dataSetSel')?.value">
      <!-- <ng-container *ngIf="legendLayer_src; else legendTabledap"> -->
      <ng-container *ngIf="legendLayer_src">
        <img [src]="legendLayer_src">

      </ng-container>
      <!-- <ng-template #legendTabledap>
        <img src="https://upload.wikimedia.org/wikipedia/commons/c/cf/Google_URL_Shortener_Logo.png">

      </ng-template> -->

    </ng-container>


  </div>


  <!-- START MAP -->
  <div class="map-container">
    <div class="map-frame">
      <div id="map"></div>
    </div>
  </div>
  <!-- END MAP -->
</div>
